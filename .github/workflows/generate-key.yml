name: Generate CRX Private Key (Manual)

on:
  workflow_dispatch:

jobs:
  generate-key:
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate RSA private key
        run: |
          openssl genpkey -algorithm RSA -out private-key.pem -pkeyopt rsa_keygen_bits:2048
          
          echo "========================================="
          echo "秘密鍵が生成されました"
          echo "========================================="
          echo ""
          echo "以下のコマンドを実行して、Base64エンコードされた秘密鍵を取得してください:"
          echo ""
          echo "  base64 -w 0 private-key.pem"
          echo ""
          echo "その後、GitHubリポジトリの Settings > Secrets and variables > Actions で"
          echo "新しいシークレット 'CRX_PRIVATE_KEY' を作成し、上記の出力を設定してください。"
          echo ""
          echo "========================================="
          
          # Base64エンコードして表示
          echo ""
          echo "Base64エンコードされた秘密鍵:"
          base64 -w 0 private-key.pem
          echo ""

      - name: Upload private key as artifact
        uses: actions/upload-artifact@v4
        with:
          name: crx-private-key
          path: private-key.pem
          retention-days: 1
