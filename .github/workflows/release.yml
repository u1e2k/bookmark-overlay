name: Build and Release CRX

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build ZIP
        run: |
          # manifest.jsonからバージョンを取得
          VERSION=$(jq -r '.version' manifest.json)
          
          # ZIPファイルを生成
          zip -r "quick-access-bookmarks-${VERSION}.zip" . \
            -x "*.git*" \
            -x "*.github*" \
            -x "README.md" \
            -x "RELEASE.md"
          
          echo "VERSION=${VERSION}" >> $GITHUB_ENV

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: quick-access-bookmarks-${{ env.VERSION }}.zip
          body: |
            ## Quick Access Bookmarks v${{ env.VERSION }}
            
            ### インストール方法
            
            1. `quick-access-bookmarks-${{ env.VERSION }}.zip` をダウンロード・解凍
            2. Chrome拡張機能ページ (`chrome://extensions/`) を開く
            3. 「デベロッパーモード」を有効化
            4. 「パッケージ化されていない拡張機能を読み込む」をクリック
            5. 解凍したフォルダを選択
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
